From 729f8b83b1002ae272e75a6139631846946f728f Mon Sep 17 00:00:00 2001
From: Kern Sibbald <kern@sibbald.com>
Date: Thu, 10 Sep 2009 15:19:13 +0200
Subject: [PATCH] Add more info when SD connection refused

as mentioned in bug #1371
---
 bacula/src/stored/dircmd.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/bacula/src/stored/dircmd.c b/bacula/src/stored/dircmd.c
index 4f4a2d7..b011802 100644
--- a/bacula/src/stored/dircmd.c
+++ b/bacula/src/stored/dircmd.c
@@ -152,7 +152,7 @@ void *handle_connection_request(void *arg)
    char tbuf[100];
 
    if (bs->recv() <= 0) {
-      Emsg0(M_ERROR, 0, _("Connection request failed.\n"));
+      Emsg1(M_ERROR, 0, _("Connection request from %s failed.\n"), bs->who());
       bs->close();
       return NULL;
    }
@@ -162,7 +162,7 @@ void *handle_connection_request(void *arg)
     */
    if (bs->msglen < 25 || bs->msglen > (int)sizeof(name)) {
       Dmsg1(000, "<filed: %s", bs->msg);
-      Emsg1(M_ERROR, 0, _("Invalid connection. Len=%d\n"), bs->msglen);
+      Emsg2(M_ERROR, 0, _("Invalid connection from %s. Len=%d\n"), bs->who(), bs->msglen);
       bs->close();
       return NULL;
    }
-- 
1.6.4.2

