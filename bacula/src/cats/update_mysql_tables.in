#!/bin/sh
#
# Shell script to update MySQL tables from version 2.0 to 3.0	
#
echo " "
echo "This script will update a Bacula MySQL database from version 10 to 11"
echo " which is needed to convert from Bacula version 2.0.x to 3.0.x or higher"
echo " "
bindir=@SQL_BINDIR@
db_name=@db_name@

if $bindir/mysql $* -f <<END-OF-DATA
USE ${db_name};

-- Create a table like Job for long term statistics
CREATE TABLE JobHistory (LIKE Job);

-- Fix bad index on Media table
DROP INDEX inx8;
CREATE UNIQUE INDEX inx8 ON Media (VolumeName(128));

DELETE FROM Version;
INSERT INTO Version (VersionId) VALUES (11);

END-OF-DATA
then
   echo "Update of Bacula MySQL tables succeeded."
else
   echo "Update of Bacula MySQL tables failed."
fi
exit 0
