#!/bin/sh
#
# Shell script to update PostgreSQL tables from version 1.38 to 1.39
#
echo " "
echo "This script will update a Bacula PostgreSQL database from version 9 to 9"
echo "Depending on the size of your database,"
echo "this script may take several minutes to run."
echo " "
bindir=@SQL_BINDIR@

if $bindir/psql -f - -d bacula $* <<END-OF-DATA

ALTER TABLE media ADD COLUMN DeviceId integer;
UPDATE media SET DeviceId=0;
ALTER TABLE media ADD COLUMN MediaTypeId integer;
UPDATE media SET MediaTypeId=0;
ALTER TABLE media ADD COLUMN LocationId integer;
UPDATE media SET LocationId=0;


CREATE TABLE MAC (
    JobId	      serial	  not null,
    OriginalJobId     serial	  not null,
    JobType	      char(1)	  not null,
    JobLevel	      char(1)	  not null,
    SchedTime	      timestamp   without time zone not null,
    StartTime	      timestamp   without time zone,
    EndTime	      timestamp   without time zone,
    JobTDate	      bigint	  not null,
    primary key (JobId)
);

CREATE TABLE Location (
   LocationId SERIAL,
   Location TEXT NOT NULL,
   PRIMARY KEY(LocationId)
   );


INSERT INTO version (versionId) VALUES (9);

vacuum;

END-OF-DATA
then
   echo "Update of Bacula PostgreSQL tables succeeded."
else
   echo "Update of Bacula PostgreSQL tables failed."
fi
exit 0
