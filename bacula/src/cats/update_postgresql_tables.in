#!/bin/sh
#
# Shell script to update PostgreSQL tables from version 2.0.0 to 3.0.0 or higher
#
echo " "
echo "This script will update a Bacula PostgreSQL database from version 10 to 11"
echo " which is needed to convert from Bacula version 2.0.0 to 3.0.x or higher"
echo " "
bindir=@SQL_BINDIR@
db_name=@db_name@

if $bindir/psql -f - -d ${db_name} $* <<END-OF-DATA

-- Create a table like Job for long term statistics
CREATE TABLE jobstat (LIKE job);

UPDATE version SET versionid=11;

vacuum analyse;

END-OF-DATA
then
   echo "Update of Bacula PostgreSQL tables succeeded."
else
   echo "Update of Bacula PostgreSQL tables failed."
fi
exit 0
