              Technical notes on version 1.38  
                        Kern Sibbald

General:

Changes to 1.38.3:
09Dec05
- Merge updates into 1.38 branch
- Update specs to include mysql4 define.
- Stop read_record() if status not ok in second loop.
- Return rec->FileIndex in dcr->VolLastIndex for normal
  and partial records in read_record().  This allows bscan
  to get FileIndex at EOT correct.
- Fix butil.c to correctly set dcr -- fixes seg fault in bls.
08Dec05
- Apply patch supplied by user (slightly modified) to fix
  correct detection of holes in block devices and FIFOs. 
  Bug # 506.
- Apply patch supplied by user (slightly modified) 
  to fix SD hang with multiple pools and bad client
  IP. Fixes bug # 508.
07Dec05
- Add nagios plugin to the examples directory. Submitted by
  Christian Masopust.
- Remove warning message about multiple saves of hardlinked files
  from find_one.c as it can generate too many warning messages.
06Dec05
- Reset timeout values before select() per patch from 
  Frank Sweetser for problems with non-blocking sockets.
- Unlink the state file if either reading or writing it gets
  errors.  Hopefully this will fix Win32 exit problems.
- Add sanity check in append.c to ensure that dcr is not NULL.
  This can happen if multiple drive autochanger SCSI control
  channel and drive indicies do not correspond.
05Dec05
- Get next volume from Scratch pool before creating a volume.
- Set new Pool defaults in Vol when moved from Scratch Pool.
- Remove argument from create_bacula_database for SQLite as it
  caused an error.
- Add back next_vol index code so that two drive autochangers can get
  a second tape.
- Change a bunch of debug levels to aid debugging autochangers.
- Fix reservation so that mutexes are properly applied.
- Rework reservation algorithm so that two drives can be used
  at the same time.
04Dec05
- Apply days keyword patch from Alexander.Bergolth at wu-wien.ac.at 
  If this patch is applied, the number of days can be specified with
  "list nextvol days=xx"
  or
  "status dir days=xx"
  My use case is to be able to preview the next scheduled job (and the 
  next tape to be used) on fridays if there are no scheduled jobs during 
  the weekend.
Changes to 1.39.1:
03Dec05
- Fix font code in gnome2 console user patch. Fixes bug #501.
- Fix malformatted bnet error message that caused seg fault
  fixes bug 502
- Applied user patch to improve README.vc8 in src/win32.
29Nov05
- Correct some more editing of JobId's (for 64 bit compatibility).
- Ensure that StorageId is stored in Media record when ever possible.
- Add Migration Job to Job.
- Change Start Storage daemon job to require read and write storage
  pointers.
- Pass read storage data to SD as well as write storage data.
- Remove old code from winservice.cpp
- Break on error in scan.
- Fix typo in signal.c
- Separate read/write DCR in SD.  Add jcr->read_dcr.
- Cleanup how find_device() works.
- Add read output to Status in SD.
21Nov05
- Remove abs() in bfile.c so that it compiles on Solaris. 
  Bug #491.

Changes to 1.38.2: 22 November 2005
20Nov05
- Fix crash in tray-monitor when daemon disconnects. Bug #479.
- Fix bnet-server bug found on OpenBSD. Bug #486 (bug originator
  says this does not fix *his* bug).
- Fix cancel failure bug. Bug #481
- Fix failure when Pool name has spaces. Bug #487   
- Fix SD crash in autochanger code. Mutex failure. Bug #488
- Fix a couple of free()s in src/filed/acl.c
- Fix memory overrun in bfile.c in building OS X resource
  fork filename. Bug #489 
- Add Pool name to SD status output.
- Add Python install dir for Solaris to configure. Bug #492

Changes to 1.38.1: 15 November 2005
14Nov05
- Apply SunOS patch for ACLs submitted by David Duchscher.                  
- Make sure to set storage before trying to set drive.
- Add bacula_mail_summary.sh to examples directory. It makes
  a single email summary of any number of jobs. Submitted
  by Adrew J. Millar.
- Make sure when we do a mount to unblock the device even
  if the drive could not be opened.  
13Nov05
- Merge Scott's new spec files.
- Add doc on setting up Win32 environment variable supplied
  by Kees van den Broek.               
- Turn off API debug output unless debug set to avoid confusing
  the user.
- Add Solaris ACL detection in configure.in as supplied by
  Attila Fulop. 
12Nov05
- Implement "autochanger drives" protocol so that Dir knows
  how many drives an autochanger has.
- Do not request drive number in label, ... if only one drive.
- Turn off debug code.
- Fix update slots to clear slot number of every slot before
  setting it.  This fixes (I believe) bug #471
- Make unmount unload the autochanger slot.
- Modify open() on mount to be read-only and non-blocking,      
  otherwise the mount can block for a long time.
- Make a few error message numbers unique.
- Make a few error messages more correct.
- Apply patch from Thorsten to fix Win98 stat() command.
10Nov05
- Remove delete of CVS from all makefiles.
- Fix seg fault when clicking on Add button in wx-console
  restore panel.  Bug #470.
- Fix copyright date and URL typo -- bug #468.
- Change autostart install for FreeBSD to look for rc.conf  
  rather than rc.local as suggested fix for bug #466.
- Apply patch supplied by Eric Bollinger to fix PostgreSQL    
  grant on status. Bug #465
- Apply patch supplied by Eric Bollinger to fix PostgreSQL
  update script. Bug #464
- Fix off by one for last Slot of autochanger for label.
- Update release date.
- Tweak an authentication error message in dir.
- Fix autoloader so that mutex is set and released around
  each run_program().  There was a missing set.
- Remove an unnecessary drive release in autochanger.
- Modify configure.in to add execute option to sqlite3 catalog  
  scripts.
- Create update_xxx_table_8_to_9 scripts for updatedb
- Fix wrong variable in bpipe.c debug output reported by user.
- Fix improper placement of encode_and_send_attributes() in
  FD backup.c causing first file of non-portable Win32 backup
  to have wrong stream. Reported by Thorsten.
- Move the -lcrypt for PostgreSQL after the PostgreSQL libs in
  autoconf/bacula-macros/db.m4 as suggested by user.  Fixes bug #457.
- Remove @STATIC_CONS@ from tray-monitor Makefile as suggested
  by user. Fixes bug #456.

Released 1.38.0 (28Oct05): 31 October 2005
