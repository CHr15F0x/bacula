#!/bin/sh
#
# Cleanup left over files -- both before and after test run
#
rm -rf /tmp/TestVolume001 /tmp/bacula-restores /tmp/Small*
rm -rf tmp/original tmp/bacula-restores tmp/Small* tmp/TestVolume*
rm -rf tmp/restored tmp/largefile tmp/bscan.bsr tmp/log*.out

if ! test x@autochanger@ = x/dev/null; then
   drive=`bin/mtx-changer @autochanger@ loaded`
   if ! test x$drive = x2; then
      bin/mtx-changer @autochanger@ unload
      bin/mtx-changer @autochanger@ load 2
   fi
   mt -f @tape_drive@ rewind
   mt -f @tape_drive@ weof
fi


#
# If we have an autochanger always load tape in slot 1
#
if ! test x@autochanger@ = x/dev/null; then
   drive=`bin/mtx-changer @autochanger@ loaded`
   if ! test x$drive = x1; then
      bin/mtx-changer @autochanger@ unload
      bin/mtx-changer @autochanger@ load 1
   fi
fi

mt -f @tape_drive@ rewind
mt -f @tape_drive@ weof
