#!/bin/sh
#
# Cleanup left over files -- both before and after test run
#
scripts/cleanup

if ! test x@autochanger@ = x/dev/null; then
   drive=`bin/mtx-changer @autochanger@ loaded 0 @tape_drive1@ 1`
   if ! test x$drive = x2; then
      bin/mtx-changer @autochanger@ unload $drive @tape_drive1@ 1
      bin/mtx-changer @autochanger@ load 2 @tape_drive1@ 1
   fi
   mt -f @tape_drive1@ rewind
   mt -f @tape_drive1@ weof
   bin/mtx-changer @autochanger@ unload 2 @tape_drive1@ 1
fi


#
# If we have an autochanger always load tape in slot 1
#
if ! test x@autochanger@ = x/dev/null; then
   drive=`bin/mtx-changer @autochanger@ loaded 0 @tape_drive@ 0`
   if ! test x$drive = x1; then
      bin/mtx-changer @autochanger@ unload $drive @tape_drive@ 0
      bin/mtx-changer @autochanger@ load 1 @tape_drive@ 0
   fi
fi

mt -f @tape_drive@ rewind
mt -f @tape_drive@ weof
bin/mtx-changer @autochanger@ unload 1 @tape_drive@ 0
