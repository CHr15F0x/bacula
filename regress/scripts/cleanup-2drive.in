#!/bin/sh
#
# Cleanup left over files -- both before and after test run
#
scripts/cleanup

if test x@autochanger@ != x/dev/null; then
   slot=`bin/mtx-changer @autochanger@ loaded 0 @tape_drive1@ 1`
   echo "Slot $slot in drive 1"
   if test x$slot != x0 ; then
      echo "unload slot $slot in drive 1"
      bin/mtx-changer @autochanger@ unload $slot @tape_drive1@ 1
   fi
   slot=`bin/mtx-changer @autochanger@ loaded 0 @tape_drive@ 0`
   echo "Slot $slot in drive 0"
   if test x$slot != x0 ; then
      echo "unload slot $slot in drive 0"
      bin/mtx-changer @autochanger@ unload $slot @tape_drive@ 0
   fi


   slot=`bin/mtx-changer @autochanger@ loaded 0 @tape_drive1@ 1`
   if test x$slot != x$SLOT2; then
      echo "load slot $SLOT2 in drive 1"
      bin/mtx-changer @autochanger@ load $SLOT2 @tape_drive1@ 1
   fi
   echo "WEOF drive 1"
   mt -f @tape_drive1@ rewind
   mt -f @tape_drive1@ weof
   echo "unload slot $SLOT2 in drive 1"
   bin/mtx-changer @autochanger@ unload $SLOT2 @tape_drive1@ 1

   slot=`bin/mtx-changer @autochanger@ loaded 0 @tape_drive@ 0`
   echo "Slot $slot in drive 0"
   if test x$slot != x$SLOT1; then
      echo "load slot $SLOT1 in drive 0"
      bin/mtx-changer @autochanger@ load $SLOT1 @tape_drive@ 0
   fi
   echo "WEOF drive 0"
   mt -f @tape_drive@ rewind
   mt -f @tape_drive@ weof
   echo "unload slot $SLOT1 from drive 0"
   bin/mtx-changer @autochanger@ unload $SLOT1 @tape_drive@ 0
fi
