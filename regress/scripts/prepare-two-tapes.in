#!/bin/sh
#
# Cleanup left over files -- both before and after test run
#

. scripts/functions

scripts/cleanup

if test x@autochanger@ != x/dev/null; then
   slot=`bin/mtx-changer @autochanger@ loaded 0 dummy $DRIVE1`
   if test "x${slot}" != "x$SLOT2"; then
      bin/mtx-changer @autochanger@ unload $slot @tape_drive@ $DRIVE1
      bin/mtx-changer @autochanger@ load $SLOT2 @tape_drive@ $DRIVE1
   fi
   mt -f @tape_drive@ rewind
   mt -f @tape_drive@ weof
fi


#
# If we have an autochanger always load tape in slot 1
#
if test x@autochanger@ != x/dev/null; then
   slot=`bin/mtx-changer @autochanger@ loaded 0 dummy $DRIVE1`
   if test "x${slot}" != "x$SLOT1"; then
      bin/mtx-changer @autochanger@ unload $slot @tape_drive@ $DRIVE1
      bin/mtx-changer @autochanger@ load $SLOT1 @tape_drive@ $DRIVE1
   fi
fi

if test a$USE_FAKETAPE = a; then
   mt -f @tape_drive@ rewind
   mt -f @tape_drive@ weof
else
   cp /dev/null @tape_drive@
fi
